<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <title>Trading Journal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js -->
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <!-- Phosphor Icons (Untuk ikon yang rapi) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- ðŸ‘‡ css code file ðŸ‘‡ -->
    <link rel="stylesheet" href="./src/style/global.css" />
  </head>
  <body class="min-h-screen p-4 md:p-8">
    <div
      x-data="tradingApp()"
      x-init="initApp()"
      class="max-w-7xl mx-auto space-y-6"
    >
      <!-- Header & Stats Overview -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Title & Balance Config -->
        <div
          class="glass-panel p-5 rounded-xl md:col-span-1 flex flex-col justify-between"
        >
          <div>
            <h1
              class="text-2xl font-bold text-blue-400 flex items-center gap-2"
            >
              <i class="ph ph-notebook"></i> FX Journal Pro
            </h1>
            <p class="text-gray-400 text-xs mt-1">
              Professional Tracking Dashboard
            </p>
          </div>
          <div class="mt-4">
            <label class="text-xs text-gray-500 uppercase font-semibold"
              >Saldo Awal ($)</label
            >
            <input
              type="number"
              x-model.number="initialBalance"
              @change="recalculateStats()"
              class="input-dark w-full px-3 py-2 rounded-lg mt-1 font-mono text-lg"
            />
          </div>
        </div>

        <!-- Key Metrics -->
        <div
          class="glass-panel p-5 rounded-xl md:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-4"
        >
          <!-- Current Balance -->
          <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700">
            <p class="text-xs text-gray-400 uppercase">Saldo Saat Ini</p>
            <p
              class="text-2xl font-bold font-mono"
              :class="currentBalance >= initialBalance ? 'text-emerald-400' : 'text-rose-400'"
              x-text="formatCurrency(currentBalance)"
            ></p>
            <p
              class="text-xs mt-1"
              :class="netProfit >= 0 ? 'text-emerald-500' : 'text-rose-500'"
            >
              <span x-text="netProfit >= 0 ? '+' : ''"></span
              ><span x-text="formatCurrency(netProfit)"></span>
            </p>
          </div>

          <!-- Win Rate -->
          <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700">
            <p class="text-xs text-gray-400 uppercase">Win Rate</p>
            <p
              class="text-2xl font-bold text-white font-mono"
              x-text="winRate + '%'"
            ></p>
            <div
              class="w-full bg-gray-700 h-1.5 mt-2 rounded-full overflow-hidden"
            >
              <div
                class="bg-blue-500 h-full"
                :style="`width: ${winRate}%`"
              ></div>
            </div>
          </div>

          <!-- Profit Factor -->
          <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700">
            <p class="text-xs text-gray-400 uppercase">Profit Factor</p>
            <p
              class="text-2xl font-bold text-amber-400 font-mono"
              x-text="profitFactor"
            ></p>
            <p class="text-xs text-gray-500 mt-1">Gross Win / Gross Loss</p>
          </div>

          <!-- Total Trades -->
          <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700">
            <p class="text-xs text-gray-400 uppercase">Total Trade</p>
            <p
              class="text-2xl font-bold text-white font-mono"
              x-text="entries.length"
            ></p>
            <p class="text-xs text-gray-500 mt-1">
              <span
                class="text-emerald-400"
                x-text="entries.filter(e => e.outcome === 'WIN').length + ' W'"
              ></span>
              /
              <span
                class="text-rose-400"
                x-text="entries.filter(e => e.outcome === 'LOSS').length + ' L'"
              ></span>
            </p>
          </div>
        </div>
      </div>

      <!-- Main Content Area: Table Only -->
      <div class="w-full">
        <!-- Full Width: Trade History Table -->
        <div class="glass-panel p-0 rounded-xl overflow-hidden">
          <div
            class="p-5 border-b border-slate-700 flex justify-between items-center bg-slate-800/30"
          >
            <div class="flex items-center gap-4">
              <h3 class="font-semibold text-lg text-white">Riwayat Trading</h3>
              <button
                @click="clearData"
                class="text-xs text-red-400 hover:text-red-300 underline opacity-60 hover:opacity-100 transition-opacity"
              >
                (Reset Data)
              </button>
            </div>
            <button
              @click="showModal = true"
              class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-lg shadow-blue-500/20 text-sm font-medium"
            >
              <i class="ph ph-plus-circle text-lg"></i> Entry Baru
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
              <thead
                class="bg-slate-800 text-slate-400 uppercase text-xs font-semibold"
              >
                <tr>
                  <th class="px-6 py-3">Tanggal</th>
                  <th class="px-6 py-3">Pair/Setup</th>
                  <th class="px-6 py-3">Posisi</th>
                  <th class="px-6 py-3 text-right">Harga</th>
                  <th class="px-6 py-3 text-center">RR</th>
                  <th class="px-6 py-3 text-right">P/L ($)</th>
                  <th class="px-6 py-3 text-center">Aksi</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-700">
                <template
                  x-for="(entry, index) in sortedEntries"
                  :key="entry.id"
                >
                  <tr class="hover:bg-slate-800/50 transition-colors group">
                    <td
                      class="px-6 py-4 text-slate-400"
                      x-text="formatDate(entry.date)"
                    ></td>
                    <td class="px-6 py-4">
                      <div
                        class="font-bold text-white text-base"
                        x-text="entry.pair"
                      ></div>
                      <div
                        class="text-xs text-slate-500"
                        x-text="entry.strategy"
                      ></div>
                    </td>
                    <td class="px-6 py-4">
                      <span
                        class="px-2 py-1 rounded text-xs font-bold uppercase tracking-wide"
                        :class="entry.type === 'buy' ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20' : 'bg-rose-500/10 text-rose-400 border border-rose-500/20'"
                        x-text="entry.type"
                      >
                      </span>
                      <span
                        class="ml-2 text-slate-400"
                        x-text="entry.lot + ' Lot'"
                      ></span>
                    </td>
                    <td
                      class="px-6 py-4 text-right font-mono text-xs text-slate-300"
                    >
                      <div>
                        <span class="text-slate-500 w-6 inline-block">OP:</span>
                        <span x-text="entry.entryPrice"></span>
                      </div>
                      <div>
                        <span class="text-slate-500 w-6 inline-block">TP:</span>
                        <span x-text="entry.tpPrice"></span>
                      </div>
                      <div>
                        <span class="text-slate-500 w-6 inline-block">SL:</span>
                        <span x-text="entry.slPrice"></span>
                      </div>
                    </td>
                    <td class="px-6 py-4 text-center">
                      <span
                        class="text-slate-300 font-mono bg-slate-800 px-2 py-1 rounded"
                        x-text="'1:' + entry.rrRatio"
                      ></span>
                    </td>
                    <td
                      class="px-6 py-4 text-right font-bold text-base"
                      :class="entry.profit >= 0 ? 'text-emerald-400' : 'text-rose-400'"
                      x-text="(entry.profit >= 0 ? '+' : '') + formatCurrency(entry.profit)"
                    ></td>
                    <td class="px-6 py-4 text-center">
                      <button
                        @click="deleteEntry(entry.id)"
                        class="text-slate-500 hover:text-rose-400 transition-colors opacity-0 group-hover:opacity-100 p-2"
                      >
                        <i class="ph ph-trash text-lg"></i>
                      </button>
                    </td>
                  </tr>
                </template>
                <tr x-show="entries.length === 0">
                  <td colspan="7" class="px-6 py-12 text-center text-slate-500">
                    <i
                      class="ph ph-notebook text-4xl mb-2 opacity-50 block"
                    ></i>
                    <span class="italic"
                      >Belum ada data trading. Klik tombol "Entry Baru" di kanan
                      atas.</span
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- MODAL FORM -->
      <div
        x-show="showModal"
        x-cloak
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
      >
        <div
          class="glass-panel w-full max-w-2xl rounded-xl p-6 relative overflow-y-auto max-h-[90vh]"
          @click.outside="showModal = false"
        >
          <button
            @click="showModal = false"
            class="absolute top-4 right-4 text-slate-400 hover:text-white"
          >
            <i class="ph ph-x text-2xl"></i>
          </button>

          <h2
            class="text-xl font-bold mb-6 text-white border-b border-slate-700 pb-2"
          >
            Input Trade Baru
          </h2>

          <form @submit.prevent="addEntry" class="space-y-4">
            <!-- Row 1 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-slate-400 mb-1"
                  >Pair (Symbol)</label
                >
                <input
                  x-model="form.pair"
                  type="text"
                  placeholder="XAUUSD"
                  class="input-dark w-full px-3 py-2 rounded uppercase"
                  required
                />
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-1"
                  >Waktu Entry</label
                >
                <input
                  x-model="form.date"
                  type="datetime-local"
                  class="input-dark w-full px-3 py-2 rounded"
                  required
                />
              </div>
            </div>

            <!-- Row 2 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm text-slate-400 mb-1">Posisi</label>
                <select
                  x-model="form.type"
                  class="input-dark w-full px-3 py-2 rounded"
                  required
                >
                  <option value="buy">BUY (Long)</option>
                  <option value="sell">SELL (Short)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-1"
                  >Lot Size</label
                >
                <input
                  x-model.number="form.lot"
                  type="number"
                  step="0.01"
                  class="input-dark w-full px-3 py-2 rounded"
                  required
                />
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-1"
                  >Strategi</label
                >
                <select
                  x-model="form.strategy"
                  class="input-dark w-full px-3 py-2 rounded"
                >
                  <option value="SMC">SMC</option>
                  <option value="Price Action">Price Action</option>
                  <option value="Breakout">Breakout</option>
                  <option value="Scalping">Scalping</option>
                  <option value="News">News Trade</option>
                </select>
              </div>
            </div>

            <!-- Row 3: Prices -->
            <div
              class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-slate-800/50 p-4 rounded-lg border border-slate-700"
            >
              <div>
                <label class="block text-sm text-blue-400 mb-1 font-bold"
                  >Entry Price</label
                >
                <input
                  x-model.number="form.entryPrice"
                  type="number"
                  step="any"
                  class="input-dark w-full px-3 py-2 rounded font-mono"
                  required
                />
              </div>
              <div>
                <label class="block text-sm text-rose-400 mb-1 font-bold"
                  >Stop Loss (SL)</label
                >
                <input
                  x-model.number="form.slPrice"
                  type="number"
                  step="any"
                  class="input-dark w-full px-3 py-2 rounded font-mono"
                  required
                />
              </div>
              <div>
                <label class="block text-sm text-emerald-400 mb-1 font-bold"
                  >Take Profit (TP)</label
                >
                <input
                  x-model.number="form.tpPrice"
                  type="number"
                  step="any"
                  class="input-dark w-full px-3 py-2 rounded font-mono"
                  required
                />
              </div>
            </div>

            <!-- Row 4: Result -->
            <div>
              <label class="block text-sm text-slate-400 mb-1"
                >Hasil Akhir (Outcome)</label
              >
              <div class="grid grid-cols-2 gap-4">
                <button
                  type="button"
                  @click="form.outcome = 'TP'"
                  :class="form.outcome === 'TP' ? 'bg-emerald-600 text-white ring-2 ring-emerald-400' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'"
                  class="py-3 rounded-lg font-bold transition-all"
                >
                  KENA TP (WIN)
                </button>
                <button
                  type="button"
                  @click="form.outcome = 'SL'"
                  :class="form.outcome === 'SL' ? 'bg-rose-600 text-white ring-2 ring-rose-400' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'"
                  class="py-3 rounded-lg font-bold transition-all"
                >
                  KENA SL (LOSS)
                </button>
              </div>
              <input type="hidden" x-model="form.outcome" required />
            </div>

            <div class="pt-4 border-t border-slate-700 flex justify-end gap-3">
              <button
                type="button"
                @click="showModal = false"
                class="px-4 py-2 text-slate-300 hover:text-white transition-colors"
              >
                Batal
              </button>
              <button
                type="submit"
                class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold shadow-lg shadow-blue-500/30 transition-all transform active:scale-95"
              >
                Simpan ke Jurnal
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer
      class="mt-8 py-6 border-t border-slate-700 max-w-7xl mx-auto text-center text-slate-500 text-sm"
    >
      <div class="mb-2">
        Built by Riza Alraihany &bull; Tracking Your Trading Consistency
      </div>
      <div class="flex justify-center space-x-4">
        <!-- Instagram Link -->
        <a
          href="https://www.instagram.com/maripos______/"
          target="_blank"
          class="text-slate-400 hover:text-pink-500 transition-colors flex items-center gap-1"
        >
          <i class="ph-fill ph-instagram-logo text-lg"></i> Instagram
        </a>
        <!-- LinkedIn Link -->
        <a
          href="https://www.linkedin.com/in/riza-alraihany-2374b032b"
          target="_blank"
          class="text-slate-400 hover:text-blue-500 transition-colors flex items-center gap-1"
        >
          <i class="ph-fill ph-linkedin-logo text-lg"></i> LinkedIn
        </a>
      </div>
    </footer>
    <!-- END FOOTER -->
    <!-- ðŸ‘‡ javascript code file ðŸ‘‡ -->
    <script src="./src/js/index.js"></script>
  </body>
</html>
